(function(){var app;app=angular.module("narwhal",["ionic","narwhal.login","narwhal.report","narwhal.recurring","ui.router","angular-locker"]),app.run(function($ionicPlatform,$rootScope){return $ionicPlatform.ready(function(){return console.log("Ready!"),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar?StatusBar.styleDefault():void 0}),$rootScope.$on("$stateChangeStart",function(event,toState){return console.log("Changed route to "+toState.url),console.log("Changed route to "+toState.name)}),$rootScope.$on("$stateChangeError",function(event,toState,toParams,fromState,fromParams,error){return console.error("Could not change state"),console.error(error)}),$rootScope.$on("$stateChangeSuccess",function(){return console.log("Successfuly changed state")})}),app.config(function($stateProvider,$urlRouterProvider){$stateProvider.state("index",{url:"/",controller:"IndexController",templateUrl:"templates/index.html"}),$urlRouterProvider.otherwise("/")})}).call(this),function(){var slice=[].slice;this.BaseController=function(){function BaseController(){var args,fn,i,index,key,len,ref,ref1;for(args=1<=arguments.length?slice.call(arguments,0):[],ref=this.constructor.$inject,index=i=0,len=ref.length;len>i;index=++i)key=ref[index],this[key]=args[index];ref1=this.constructor.prototype;for(key in ref1)fn=ref1[key],"function"==typeof fn&&"constructor"!==key&&"initialize"!==key&&"_"!==key[0]&&(this.$scope[key]=("function"==typeof fn.bind?fn.bind(this):void 0)||_.bind(fn,this));"function"==typeof this.initialize&&this.initialize()}return BaseController.register=function(app,name){var ref;return null==name&&(name=this.name||(null!=(ref=this.toString().match(/function\s*(.*?)\(/))?ref[1]:void 0)),app.controller(name,this)},BaseController.inject=function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],this.$inject=args},BaseController}()}.call(this),function(){var app;app=angular.module("narwhal"),app.factory("User",["$http",function($http){var User;return new(User=function(){function User(){}return User.prototype.login=function(username,password){var request;return request=$http.post("https://nameless-scrubland-4785.herokuapp.com/v1/session/",{email:username,password:password})},User.prototype.getTransactions=function(sessionToken){var request;return request=$http.get("https://nameless-scrubland-4785.herokuapp.com/v1/transactions",{params:{session_token:sessionToken}})},User}())}])}.call(this),function(){var loginModule;loginModule=angular.module("narwhal.login",[]),loginModule.config(function($stateProvider){return $stateProvider.state("login",{url:"/login/",templateUrl:"templates/login.html",controller:"LoginController"})})}.call(this),function(){var recurringModule;recurringModule=angular.module("narwhal.recurring",[]),recurringModule.config(function($stateProvider){return $stateProvider.state("recurring",{url:"/recurring/",templateUrl:"templates/recurring.html",controller:"RecurringController",resolve:{currentTransaction:["$rootScope",function($rootScope){return $rootScope.currentTransaction}]}})})}.call(this),function(){var reportModule;reportModule=angular.module("narwhal.report",[]),reportModule.config(function($stateProvider){return $stateProvider.state("report",{url:"/report/",templateUrl:"templates/report.html",controller:"ReportController"})})}.call(this),function(){var IndexController,app,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;app=angular.module("narwhal"),IndexController=function(superClass){function IndexController(){return this.getRandomAmount=bind(this.getRandomAmount,this),this.loadTransactions=bind(this.loadTransactions,this),this.initialize=bind(this.initialize,this),IndexController.__super__.constructor.apply(this,arguments)}return extend(IndexController,superClass),IndexController.register(app),IndexController.inject("$scope","$http","$state","$rootScope","User","$ionicNavBarDelegate","locker"),IndexController.prototype.initialize=function(){var result;return this.$scope.transactions=[],result=this.$ionicNavBarDelegate.showBackButton(!1),this.loadTransactions(),this.locker.has("session_token")&&(this.$rootScope.session_token=this.locker.get("session_token")),this.locker.has("transactions")?(this.$scope.transactions=this.locker.get("transactions"),setTimeout(Mi.motion.fadeSlideInRight({selector:".animate-fade-slide-in-right > *"}),300)):void 0},IndexController.prototype.logout=function(){return this.locker.forget("session_token"),this.$state.go("login")},IndexController.prototype.refresh=function(){return this.loadTransactions(),this.$scope.$broadcast("scroll.refreshComplete"),setTimeout(Mi.motion.fadeSlideInRight({selector:".animate-fade-slide-in-right > *"}),10)},IndexController.prototype.loadTransactions=function(){return this.User.getTransactions(this.$rootScope.session_token).then(function(_this){return function(result){return _this.$scope.transactions=result.data,_this.locker.put("transactions",_this.$scope.transactions)}}(this))},IndexController.prototype.getRandomAmount=function(){return Math.floor(5e3*Math.random())/100},IndexController.prototype.showTransaction=function(transaction){return console.log("Current Transaction"),console.log(transaction),this.$rootScope.currentTransaction=transaction,this.$state.go("recurring")},IndexController}(BaseController)}.call(this),function(){var LoginController,loginModule,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;loginModule=angular.module("narwhal.login"),LoginController=function(superClass){function LoginController(){return this.initialize=bind(this.initialize,this),this.login=bind(this.login,this),LoginController.__super__.constructor.apply(this,arguments)}return extend(LoginController,superClass),LoginController.register(loginModule),LoginController.inject("$scope","$http","$state","User","$rootScope","$ionicViewSwitcher","locker"),LoginController.prototype.login=function(){return this.$scope.isLoading=!0,this.User.login(this.$scope.username,this.$scope.password).then(function(_this){return function(result){return _this.$scope.isLoading=!1,_this.$ionicViewSwitcher.nextDirection("swap"),_this.$rootScope.session_token=result.data.session_token,_this.locker.put("session_token",_this.$rootScope.session_token),_this.$state.go("index")}}(this))},LoginController.prototype.initialize=function(){return this.$ionicViewSwitcher.nextDirection("swap"),console.log("initialized login module"),this.locker.get("session_token")?this.$rootScope.session_token=this.locker.get("session_token"):void 0},LoginController}(BaseController)}.call(this),function(){angular.module("narwhal.login").directive("ionMdInput",function(){return{restrict:"E",replace:!0,require:"?ngModel",template:'<label class="item item-input item-md-label"><input type="text"><span class="input-label"></span><div class="highlight"></div></label>',compile:function(element,attr){var cleanUp,highlight,highlightColor,input,label;highlight=element[0].querySelector(".highlight"),highlightColor=void 0,highlightColor=attr.highlightColor?attr.highlightColor:"calm",highlight.className+=" highlight-"+highlightColor,label=element.find("span"),label.html(attr.placeholder),input=element.find("input"),input.bind("blur",function(){console.log("blur"),input.val()?input.addClass("used"):input.removeClass("used")}),angular.forEach({name:attr.name,type:attr.type,"ng-value":attr.ngValue,"ng-model":attr.ngModel,required:attr.required,"ng-required":attr.ngRequired,"ng-minlength":attr.ngMinlength,"ng-maxlength":attr.ngMaxlength,"ng-pattern":attr.ngPattern,"ng-change":attr.ngChange,"ng-trim":attr.trim,"ng-blur":attr.ngBlur,"ng-focus":attr.ngFocus},function(value,name){angular.isDefined(value)&&input.attr(name,value)}),cleanUp=function(){ionic.off("$destroy",cleanUp,element[0])},ionic.on("$destroy",cleanUp,element[0])}}})}.call(this),function(){var RecurringController,recurringModule,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;recurringModule=angular.module("narwhal.recurring"),RecurringController=function(superClass){function RecurringController(){return RecurringController.__super__.constructor.apply(this,arguments)}return extend(RecurringController,superClass),RecurringController.register(recurringModule),RecurringController.inject("$scope","$http","$scope","$rootScope","$stateParams","$state","currentTransaction","$ionicNavBarDelegate","$ionicViewSwitcher"),RecurringController.prototype.initialize=function(){return this.$rootScope.currentTransaction?void 0:(this.$ionicViewSwitcher.nextDirection("back"),this.$state.go("index"))},RecurringController}(BaseController)}.call(this),function(){var ReportController,reportModule,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;reportModule=angular.module("narwhal.report"),ReportController=function(superClass){function ReportController(){return ReportController.__super__.constructor.apply(this,arguments)}return extend(ReportController,superClass),ReportController.register(reportModule),ReportController.inject("$scope"),ReportController.prototype.initialize=function(){return setTimeout(function(){return Mi.motion.blindsDown({selector:".card"})},500)},ReportController}(BaseController)}.call(this);var Mi=Mi||{};Mi=function(){"use strict";function getViewportHeight(){return window.innerHeight}function blindsDown(options){var defaults={finishDelayThrottle:2,finishSpeedPercent:.5,leftOffsetPercentage:.8,startVelocity:1100};"undefined"==typeof options&&(options={}),options.finishDelayThrottle=options.finishDelayThrottle||defaults.finishDelayThrottle,options.finishSpeedPercent=options.finishSpeedPercent||defaults.finishSpeedPercent,options.leftOffsetPercentage=options.leftOffsetPercentage||defaults.leftOffsetPercentage,options.startVelocity=options.startVelocity||defaults.startVelocity;var isInvalidSelector="undefined"==typeof options.selector||""===options.selector;if(isInvalidSelector)return console.log("invalid blindsDown selector"),!1;for(var animateBlindsDom=document.querySelectorAll(options.selector),elementAnimationCount=0,viewportHeight=getViewportHeight(),i=0;i<animateBlindsDom.length&&animateBlindsDom[i].offsetTop<viewportHeight;i++)elementAnimationCount+=1;for(var speed=options.startVelocity,i=0;elementAnimationCount>i;i++){var child=animateBlindsDom[i],childOffset=child.getBoundingClientRect(),offset=childOffset.left*options.leftOffsetPercentage+childOffset.top,delay=parseFloat(offset/speed).toFixed(2);child.style.webkitTransitionDelay=delay+"s",child.style.transitionDelay=delay+"s",child.className+=" in"}setTimeout(function(){for(var i=0;elementAnimationCount>i;i++){var child=animateBlindsDom[i],childOffset=child.getBoundingClientRect(),offset=childOffset.left*options.leftOffsetPercentage+childOffset.top,delay=parseFloat(offset/speed/options.finishDelayThrottle).toFixed(2);child.querySelector("img").style.webkitTransitionDelay=delay+"s",child.querySelector("img").style.transitionDelay=delay+"s",animateBlindsDom[i].parentNode.className+=" done"}},speed*options.finishSpeedPercent)}function fadeSlideIn(options){var defaults={finishDelayThrottle:2,finishSpeedPercent:.72,leftOffsetPercentage:.8,startVelocity:1100};"undefined"==typeof options&&(options={}),options.finishDelayThrottle=options.finishDelayThrottle||defaults.finishDelayThrottle,options.finishSpeedPercent=options.finishSpeedPercent||defaults.finishSpeedPercent,options.leftOffsetPercentage=options.leftOffsetPercentage||defaults.leftOffsetPercentage,options.startVelocity=options.startVelocity||defaults.startVelocity;var isInvalidSelector="undefined"==typeof options.selector||""===options.selector;if(isInvalidSelector)return console.log("invalid fadeSlideIn selector"),!1;for(var animateFadeSlideInDom=document.querySelectorAll(options.selector),elementAnimationCount=0,viewportHeight=getViewportHeight(),i=0;i<animateFadeSlideInDom.length&&animateFadeSlideInDom[i].offsetTop<viewportHeight;i++)elementAnimationCount+=1;for(var speed=options.startVelocity,i=0;elementAnimationCount>i;i++){var child=animateFadeSlideInDom[i],childOffset=child.getBoundingClientRect(),offset=childOffset.left*options.leftOffsetPercentage+childOffset.top,delay=parseFloat(offset/speed).toFixed(2);child.style.webkitTransitionDelay=delay+"s",child.style.transitionDelay=delay+"s",child.className+=" in"}setTimeout(function(){for(var i=0;elementAnimationCount>i;i++){var child=animateFadeSlideInDom[i],childOffset=child.getBoundingClientRect(),offset=childOffset.left*options.leftOffsetPercentage+childOffset.top,delayValue=offset/speed/options.finishDelayThrottle;parseFloat(delayValue).toFixed(2)}animateFadeSlideInDom[0].className+=" done"},speed*options.finishSpeedPercent)}function fadeSlideInRight(options){var defaults={finishDelayThrottle:2,finishSpeedPercent:.72,leftOffsetPercentage:.8,startVelocity:1100};"undefined"==typeof options&&(options={}),options.finishDelayThrottle=options.finishDelayThrottle||defaults.finishDelayThrottle,options.finishSpeedPercent=options.finishSpeedPercent||defaults.finishSpeedPercent,options.leftOffsetPercentage=options.leftOffsetPercentage||defaults.leftOffsetPercentage,options.startVelocity=options.startVelocity||defaults.startVelocity;var isInvalidSelector="undefined"==typeof options.selector||""===options.selector;if(isInvalidSelector)return console.log("invalid fadeSlideInRight selector"),!1;for(var animateSlideInRightDom=document.querySelectorAll(options.selector),elementAnimationCount=0,viewportHeight=getViewportHeight(),i=0;i<animateSlideInRightDom.length&&animateSlideInRightDom[i].offsetTop<viewportHeight;i++)elementAnimationCount+=1;for(var speed=options.startVelocity,i=0;elementAnimationCount>i;i++){var child=animateSlideInRightDom[i],childOffset=child.getBoundingClientRect(),offset=childOffset.left*options.leftOffsetPercentage+childOffset.top,delay=parseFloat(offset/speed).toFixed(2);child.style.webkitTransitionDelay=delay+"s",child.style.transitionDelay=delay+"s",child.className+=" in"}setTimeout(function(){for(var i=0;elementAnimationCount>i;i++){var child=animateSlideInRightDom[i],childOffset=child.getBoundingClientRect(),offset=childOffset.left*options.leftOffsetPercentage+childOffset.top,delayValue=offset/speed/options.finishDelayThrottle;parseFloat(delayValue).toFixed(2)}console.log(animateSlideInRightDom),animateSlideInRightDom.length>0&&(animateSlideInRightDom[0].className+=" done")},speed*options.finishSpeedPercent)}function panInLeft(options){"string"==typeof options&&(options={selector:options});var isInvalidSelector="undefined"==typeof options.selector||""===options.selector;if(isInvalidSelector)return console.log("invalid pushDown selector"),!1;for(var animatePanInLeftDom=document.querySelectorAll(options.selector),elementAnimationCount=animatePanInLeftDom.length,i=0;elementAnimationCount>i;i++){var element=animatePanInLeftDom[i],classNameToRemove="animate-pan-in-left",indexOfClassNameToRemove=element.className.lastIndexOf(classNameToRemove);element.className=element.className.substr(0,indexOfClassNameToRemove)}}function pushDown(options){"string"==typeof options&&(options={selector:options});var isInvalidSelector="undefined"==typeof options.selector||""===options.selector;if(isInvalidSelector)return console.log("invalid pushDown selector"),!1;for(var animatePushDownDom=document.querySelectorAll(options.selector),elementAnimationCount=animatePushDownDom.length,i=0;elementAnimationCount>i;i++){var element=animatePushDownDom[i],classNameToRemove=options.selector.split(".")[1],indexOfClassNameToRemove=element.className.lastIndexOf(classNameToRemove);element.className=element.className.substr(0,indexOfClassNameToRemove)}}function slideUp(options){"string"==typeof options&&(options={selector:options});var isInvalidSelector="undefined"==typeof options.selector||""===options.selector;if(isInvalidSelector)return console.log("invalid pushDown selector"),!1;for(var animateSlideUpDom=document.querySelectorAll(options.selector),elementAnimationCount=animateSlideUpDom.length,i=0;elementAnimationCount>i;i++){var element=animateSlideUpDom[i],classNameToRemove=options.selector.split(".")[1],indexOfClassNameToRemove=element.className.lastIndexOf(classNameToRemove);element.className=element.className.substr(0,indexOfClassNameToRemove)}}var version="0.0.1",motion={blindsDown:blindsDown,fadeSlideIn:fadeSlideIn,fadeSlideInRight:fadeSlideInRight,panInLeft:panInLeft,pushDown:pushDown,slideUp:slideUp};return{motion:motion,version:version}}(),function(window){"use strict";function isWindow(obj){return null!==obj&&obj===obj.window}function getWindow(elem){return isWindow(elem)?elem:9===elem.nodeType&&elem.defaultView}function offset(elem){var docElem,win,box={top:0,left:0},doc=elem&&elem.ownerDocument;return docElem=doc.documentElement,"undefined"!=typeof elem.getBoundingClientRect&&(box=elem.getBoundingClientRect()),win=getWindow(doc),{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}}function convertStyle(obj){var style="";for(var a in obj)obj.hasOwnProperty(a)&&(style+=a+":"+obj[a]+";");return style}function getWavesEffectElement(e){if(TouchHandler.allowEvent(e)===!1)return null;for(var element=null,target=e.target||e.srcElement;null!==target.parentElement;){if(!(target instanceof SVGElement||-1===target.className.indexOf("waves-effect"))){element=target;break}if(target.classList.contains("waves-effect")){element=target;break}target=target.parentElement}return element}function showEffect(e){var element=getWavesEffectElement(e);null!==element&&(Effect.show(e,element),"ontouchstart"in window&&(element.addEventListener("touchend",Effect.hide,!1),element.addEventListener("touchcancel",Effect.hide,!1)),element.addEventListener("mouseup",Effect.hide,!1),element.addEventListener("mouseleave",Effect.hide,!1))}var Waves=Waves||{},$$=document.querySelectorAll.bind(document),Effect={duration:750,show:function(e,element){if(2===e.button)return!1;var el=element||this,ripple=document.createElement("div");ripple.className="waves-ripple",el.appendChild(ripple);var pos=offset(el),relativeY=e.pageY-pos.top,relativeX=e.pageX-pos.left,scale="scale("+el.clientWidth/100*3+")";"touches"in e&&(relativeY=e.touches[0].pageY-pos.top,relativeX=e.touches[0].pageX-pos.left),ripple.setAttribute("data-hold",Date.now()),ripple.setAttribute("data-scale",scale),ripple.setAttribute("data-x",relativeX),ripple.setAttribute("data-y",relativeY);var rippleStyle={top:relativeY+"px",left:relativeX+"px"};ripple.className=ripple.className+" waves-notransition",ripple.setAttribute("style",convertStyle(rippleStyle)),ripple.className=ripple.className.replace("waves-notransition",""),rippleStyle["-webkit-transform"]=scale,rippleStyle["-moz-transform"]=scale,rippleStyle["-ms-transform"]=scale,rippleStyle["-o-transform"]=scale,rippleStyle.transform=scale,rippleStyle.opacity="1",rippleStyle["-webkit-transition-duration"]=Effect.duration+"ms",rippleStyle["-moz-transition-duration"]=Effect.duration+"ms",rippleStyle["-o-transition-duration"]=Effect.duration+"ms",rippleStyle["transition-duration"]=Effect.duration+"ms",ripple.setAttribute("style",convertStyle(rippleStyle))},hide:function(e){TouchHandler.touchup(e);var el=this,ripple=(1.4*el.clientWidth,null),ripples=el.getElementsByClassName("waves-ripple");if(!(ripples.length>0))return!1;ripple=ripples[ripples.length-1];var relativeX=ripple.getAttribute("data-x"),relativeY=ripple.getAttribute("data-y"),scale=ripple.getAttribute("data-scale"),diff=Date.now()-Number(ripple.getAttribute("data-hold")),delay=350-diff;0>delay&&(delay=0),setTimeout(function(){var style={top:relativeY+"px",left:relativeX+"px",opacity:"0","-webkit-transition-duration":Effect.duration+"ms","-moz-transition-duration":Effect.duration+"ms","-o-transition-duration":Effect.duration+"ms","transition-duration":Effect.duration+"ms","-webkit-transform":scale,"-moz-transform":scale,"-ms-transform":scale,"-o-transform":scale,transform:scale};ripple.setAttribute("style",convertStyle(style)),setTimeout(function(){try{el.removeChild(ripple)}catch(e){return!1}},Effect.duration)},delay)},wrapInput:function(elements){for(var a=0;a<elements.length;a++){var el=elements[a];if("input"===el.tagName.toLowerCase()){var parent=el.parentNode;if("i"===parent.tagName.toLowerCase()&&-1!==parent.className.indexOf("waves-effect"))continue;var wrapper=document.createElement("i");wrapper.className=el.className+" waves-input-wrapper";var elementStyle=el.getAttribute("style");elementStyle||(elementStyle=""),wrapper.setAttribute("style",elementStyle),el.className="waves-button-input",el.removeAttribute("style"),parent.replaceChild(wrapper,el),wrapper.appendChild(el)}}}},TouchHandler={touches:0,allowEvent:function(e){var allow=!0;return"touchstart"===e.type?TouchHandler.touches+=1:"touchend"===e.type||"touchcancel"===e.type?setTimeout(function(){TouchHandler.touches>0&&(TouchHandler.touches-=1)},500):"mousedown"===e.type&&TouchHandler.touches>0&&(allow=!1),allow},touchup:function(e){TouchHandler.allowEvent(e)}};Waves.displayEffect=function(options){options=options||{},"duration"in options&&(Effect.duration=options.duration),Effect.wrapInput($$(".waves-effect")),"ontouchstart"in window&&document.body.addEventListener("touchstart",showEffect,!1),document.body.addEventListener("mousedown",showEffect,!1)},Waves.attach=function(element){"input"===element.tagName.toLowerCase()&&(Effect.wrapInput([element]),element=element.parentElement),"ontouchstart"in window&&element.addEventListener("touchstart",showEffect,!1),element.addEventListener("mousedown",showEffect,!1)},window.Waves=Waves}(window),function(root,factory){"function"==typeof define&&define.amd?define(function(){return factory(root.angular)}):"object"==typeof exports?module.exports=factory(root.angular||window&&window.angular):factory(root.angular)}(this,function(angular){"use strict";angular.module("angular-locker",[]).provider("locker",function(){var _value=function(value,param){return angular.isFunction(value)?value(param):value},_keyByVal=function(object,value){return Object.keys(object).filter(function(key){return object[key]===value})[0]},_error=function(msg){throw new Error("[angular-locker] "+msg)},defaults={driver:"local",namespace:"locker",eventsEnabled:!0,separator:"."};return{setDefaultDriver:function(driver){return defaults.driver=_value(driver),this},getDefaultDriver:function(){return defaults.driver},setDefaultNamespace:function(namespace){return defaults.namespace=_value(namespace),this},getDefaultNamespace:function(){return defaults.namespace},setEventsEnabled:function(enabled){return defaults.eventsEnabled=_value(enabled),this},getEventsEnabled:function(){return defaults.eventsEnabled},setSeparator:function(separator){return defaults.separator=_value(separator),this},getSeparator:function(){return defaults.separator},$get:["$window","$rootScope","$parse",function($window,$rootScope,$parse){function Locker(driver,namespace){this._registeredDrivers={local:$window.localStorage,session:$window.sessionStorage},this._resolveDriver=function(driver){return this._registeredDrivers.hasOwnProperty(driver)||_error('The driver "'+driver+'" was not found.'),this._registeredDrivers[driver]},this._deriveDriver=function(driver){return _keyByVal(this._registeredDrivers,driver)},this._driver=this._resolveDriver(driver),this._namespace=namespace,this._eventsEnabled=defaults.eventsEnabled,this._separator=defaults.separator,this._watchers={},this._checkSupport=function(driver){if(angular.isUndefined(this._supported)){var l="l";try{this._resolveDriver(driver||"local").setItem(l,l),this._resolveDriver(driver||"local").removeItem(l),this._supported=!0}catch(e){this._supported=!1}}return this._supported},this._getPrefix=function(key){return this._namespace?this._namespace+this._separator+key:key},this._serialize=function(value){try{return angular.toJson(value)}catch(e){return value}},this._unserialize=function(value){try{return angular.fromJson(value)}catch(e){return value}},this._event=function(name,payload){this._eventsEnabled&&$rootScope.$emit(name,angular.extend(payload,{driver:this._deriveDriver(this._driver),namespace:this._namespace}))},this._setItem=function(key,value){this._checkSupport()||_error("The browser does not support localStorage");try{var oldVal=this._getItem(key);this._driver.setItem(this._getPrefix(key),this._serialize(value)),this._exists(key)&&!angular.equals(oldVal,value)?this._event("locker.item.updated",{key:key,oldValue:oldVal,newValue:value}):this._event("locker.item.added",{key:key,value:value})}catch(e){_error(-1!==["QUOTA_EXCEEDED_ERR","NS_ERROR_DOM_QUOTA_REACHED","QuotaExceededError"].indexOf(e.name)?"The browser storage quota has been exceeded":'Could not add item with key "'+key+'"')}},this._getItem=function(key){return this._checkSupport()||_error("The browser does not support localStorage"),this._unserialize(this._driver.getItem(this._getPrefix(key)))},this._exists=function(key){return this._checkSupport()||_error("The browser does not support localStorage"),this._driver.hasOwnProperty(this._getPrefix(_value(key)))},this._removeItem=function(key){return this._checkSupport()||_error("The browser does not support localStorage"),this._exists(key)?(this._driver.removeItem(this._getPrefix(key)),this._event("locker.item.forgotten",{key:key}),!0):!1}}return Locker.prototype={put:function(key,value){if(!key)return!1;if(key=_value(key),angular.isObject(key))angular.forEach(key,function(value,key){this._setItem(key,value)},this);else{if(!angular.isDefined(value))return!1;this._setItem(key,_value(value,this._getItem(key)))}return this},add:function(key,value){return this.has(key)?!1:(this.put(key,value),!0)},get:function(key,def){if(angular.isArray(key)){var items={};return angular.forEach(key,function(k){this.has(k)&&(items[k]=this._getItem(k))},this),items}return this.has(key)?this._getItem(key):2===arguments.length?def:void 0},has:function(key){return this._exists(key)},forget:function(key){return key=_value(key),angular.isArray(key)?key.map(this._removeItem,this):this._removeItem(key),this},pull:function(key,def){var value=this.get(key,def);return this.forget(key),value},all:function(){var items={};return angular.forEach(this._driver,function(value,key){var split=key.split(this._separator);split.length>1&&split[0]===this._namespace&&(split.splice(0,1),key=split.join(this._separator)),this.has(key)&&(items[key]=this.get(key))},this),items},clean:function(){return this.forget(Object.keys(this.all())),this},empty:function(){return this._driver.clear(),this},count:function(){return Object.keys(this.all()).length},bind:function($scope,key,def){angular.isUndefined($scope.$eval(key))&&($parse(key).assign($scope,this.get(key,def)),this.has(key)||this.put(key,def));var self=this;return this._watchers[key+$scope.$id]=$scope.$watch(key,function(newVal){angular.isDefined(newVal)&&self.put(key,newVal)},angular.isObject($scope[key])),this},unbind:function($scope,key){$parse(key).assign($scope,void 0),this.forget(key);var watchId=key+$scope.$id;return this._watchers[watchId]&&(this._watchers[watchId](),delete this._watchers[watchId]),this},driver:function(driver){return this.instance(driver,this._namespace)},getDriver:function(){return this._driver},namespace:function(namespace){return this.instance(this._deriveDriver(this._driver),namespace)},getNamespace:function(){return this._namespace},supported:function(driver){return this._checkSupport(driver)},instance:function(driver,namespace){return new Locker(driver,namespace)}},new Locker(defaults.driver,defaults.namespace)}]}})});